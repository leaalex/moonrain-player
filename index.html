<html>
	<head>
  		<meta charset="utf-8">
	</head>
<body>


<div id="id" class="media-container" data-wight="1280" data-src="https://rec.edu-kuban.ru/2016-06-17.10-19-41.6f5ef8098b922eb3_12345678/">
</div>

<div class="media-container" data-wight="1280" data-src="https://rec.edu-kuban.ru/2016-06-03.17-10-57.3950c7fb2ff18e0a_12356/">
</div>

</body>
</html>


<script type="text/javascript">
console.log("v0.1.3.mc");
function Constructor(selector){
	function status(messege, elenemt){
		console.log(">> status:" + messege, element);
	}

	// Седектор по которому происходит поиск элементов для подключения плеера
  var selector = selector || ".media-container";
	// Функция получает селектор возвращает массив обектов. В массие может быть один элемент
  function query(selector){
    var array = [];
    var elements = document.querySelectorAll(selector);
    for (var i = 0; i < elements.length; i++){
      array.push(elements[i]);
    };
    return array;
  }
	// Функция гегенрации ID
  function genID(value){
    var value = value+"_" || "id"
      return value + Math.random().toString(16).substr(2, 8).toUpperCase();
  };
	// Функция получение JSON'а по URL и преобрзование его в объект
  function getObjectJSON(urlJSON){
    var objectJSON = {};
    var request = new XMLHttpRequest();
    request.open('GET', urlJSON, false);
    request.onreadystatechange = function(e) {
        if (this.readyState == 4) {
            if (this.status == 200) {
              console.log("Загрузка успешно завершена: " , urlJSON);
              objectJSON = JSON.parse(this.responseText);
            }
            else {
              console.log("Ошибка загрузки: " + urlJSON)
            }
        }
    }
    request.send(null);
    return objectJSON;
  };

	// Функция получения свойства каждого из элементов в нутри обекта
  function mediaObjects(objectJSON, type, property){
    var elements = [];
    objectJSON[type].forEach(function(element){
        elements.push(element[property])
    });
    return elements;
  };
// Функция создания видео/аудео блока
  function createMediaELement(type, name, src){
    var element = document.createElement(type);
		element.controls = false;
		element.preload = "metadata";
    var source = document.createElement("source");
    source.src = src + name;
		source.type = "video/webm";
    element.appendChild(source);
		return element;
  };

  function createElement(tagName, id, classList, attributes, properties){

    var element = document.createElement(tagName);
    if (id) {
			element.id = id;
		};
    if (classList) {
			element.classList = classList;
		};
    if (attributes){
      for (attribute in attributes){
        element.setAttribute(attribute, attributes[attribute]);
      };
    };
		if (properties){
			for (propertiy in properties){
				element[propertiy] =  properties[propertiy];
			}
		}

    return element;
  };


this.meta = {}

  function createPlayer(mediaContainer){
    var src = mediaContainer.dataset.src;
    var objectJSON = getObjectJSON("0.json");

    var videoNames = mediaObjects(objectJSON, "video", "filename");
console.log("Список имен видео получен:", videoNames);
    var time = mediaObjects(objectJSON, "video", "instant");
console.log("Список имен audio получен:", time);
    var blockMedia = createElement("div", genID("blockMedia"),  "blockMedia", {width:"auto"})
console.log("Создано:",blockMedia);
    var blockControls = createElement("div", genID("blockControls"), "blockControls");
console.log("Создано:",blockControls);

		var blockHide = createElement("div", genID("blockHide"),"blockHide");
console.log("Создано:",blockHide);
		videoNames.forEach(function(name){
			var video = createElement("video", genID("video"),false,{width:300},{src:src + name, preload:"metadata"})
			blockHide.appendChild(video)
			video.addEventListener("loadedmetadata", function(){console.log(this, this.duration)})
		});

		mediaContainer.appendChild(blockMedia);
		mediaContainer.appendChild(blockControls);
		mediaContainer.appendChild(blockHide);

		for(var i = 0; i<time.length; i++){
			if(i!=time.length){
				var duration = time[i+1] - time[i];
				console.log(duration);
			}

		}

	};















  this.init = function(){
    var mediaContainer = query(selector);
		createPlayer(mediaContainer[0]);

  };


}
</script>
